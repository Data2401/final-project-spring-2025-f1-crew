---
title: "F1"
author: "Eric L., Rehana H., Fatima T."
output: html_document
date: "2025-04-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#packages
library(dplyr)
library(ggplot2)
library(tidyverse)
```

```{r}
#reading files
circuits<- read.csv("f1data/circuits.csv")
constructor_results<- read.csv("f1data/constructor_results.csv")
constructor_standings<- read.csv("f1data/constructor_standings.csv")
constructors<- read.csv("f1data/constructors.csv")
driver_standings<- read.csv("f1data/driver_standings.csv")
drivers<- read.csv("f1data/drivers.csv")
lap_times<- read.csv("f1data/lap_times.csv")
pit_stops<- read.csv("f1data/pit_stops.csv")
qualifying<- read.csv("f1data/qualifying.csv")
races<- read.csv("f1data/races.csv")
results<- read.csv("f1data/results.csv")
seasons<- read.csv("f1data/seasons.csv")
sprint_results<- read.csv("f1data/sprint_results.csv")
status<- read.csv("f1data/status.csv")

```


```{r}
#Functions

#convert "min:sec.ms" string to total seconds (as a number)
time_to_seconds <- function(time_str) {
  parts <- str_split_fixed(time_str, ":", 2)
  minutes <- as.numeric(parts[, 1])
  seconds_ms <- as.numeric(parts[, 2])
  return(minutes * 60 + seconds_ms)
}

#convert total seconds back to "min:sec.ms" format
seconds_to_time <- function(total_seconds) {
  minutes <- floor(total_seconds / 60)
  remaining_seconds <- total_seconds - (minutes * 60)
  return(sprintf("%d:%.3f", minutes, remaining_seconds))
}

#average lap times and mutate a new column
qualifying_average <- qualifying %>%
  mutate(
    q1_seconds = sapply(q1, time_to_seconds),
    q2_seconds = sapply(q2, time_to_seconds),
    q3_seconds = sapply(q3, time_to_seconds),
    average_seconds = case_when(
      !is.na(q1_seconds) & !is.na(q2_seconds) & !is.na(q3_seconds) ~ (q1_seconds + q2_seconds + q3_seconds) / 3,
      !is.na(q1_seconds) & !is.na(q2_seconds) & is.na(q3_seconds) ~ (q1_seconds + q2_seconds) / 2,
      TRUE ~ q1_seconds 
    ),
    average_time = sapply(average_seconds, seconds_to_time)
  ) %>%
  select(-q1_seconds, -q2_seconds, -q3_seconds)
```


```{r}
#Joins to add years to data frames for graphing

#qualifying data
qualifying_by_year<-left_join(races, qualifying_average)

#results data by year
results_LapTimeSeconds <- results %>%
  mutate(fastestLapTime_seconds = sapply(fastestLapTime , time_to_seconds))

results_by_year<- left_join(races, results_LapTimeSeconds, by = join_by(raceId))

#constructor standings by year
constructor_standings_by_year<-left_join(races, constructor_standings)
```


```{r}
#Graphs for Part A: Overview of all current F1 teams

#filtering for current teams on the grid
relevant_results = results %>%  filter(constructorId == 214 | 
                          constructorId == 117 | constructorId == 6 | 
                          constructorId == 1210 | constructorId == 1 | 
                          constructorId == 131 | constructorId == 213 |
                          constructorId == 9 | constructorId == 15 |
                          constructorId == 3)
relevant_constructors = constructors %>% filter(constructorId == 214 | 
                          constructorId == 117 | constructorId == 6 | 
                          constructorId == 1210 | constructorId == 1 | 
                          constructorId == 131 | constructorId == 213 |
                          constructorId == 9 | constructorId == 15 |
                          constructorId == 3)

#average qual time by year
qualifying_by_year %>% filter(constructorId == 214 | 
                          constructorId == 117 | constructorId == 6 | 
                          constructorId == 1210 | constructorId == 1 | 
                          constructorId == 131 | constructorId == 213 |
                          constructorId == 9 | constructorId == 15 |
                          constructorId == 3) %>% ggplot(aes(x = year,
                                        y = average_seconds)) + geom_smooth()

#fastest lap time by year
results_by_year %>% filter(constructorId == 214 | 
                          constructorId == 117 | constructorId == 6 | 
                          constructorId == 1210 | constructorId == 1 | 
                          constructorId == 131 | constructorId == 213 |
                          constructorId == 9 | constructorId == 15 |
                          constructorId == 3) %>% ggplot(aes(x = year, 
                                    y = fastestLapTime_seconds)) + geom_smooth()


```

```{r}
# graphs for Part B: A closer look at Ferrari

#filtering for ferrari
ferrari_qualifying<- qualifying_by_year %>% filter(constructorId == 6)
ferrari_results<- results_by_year %>% filter(constructorId == 6)
ferrari_standings<- constructor_standings_by_year %>% filter(constructorId ==6)

#ferrari qualifying times by year
ferrari_qualifying %>%  ggplot(aes(x = year, y = average_seconds)) + geom_smooth()

#Ferrari fastest lap times by year
ferrari_results %>% ggplot(aes(x = year, y = fastestLapTime_seconds)) + geom_smooth()

#Ferrari fastest lap speed over time
ferrari_results %>% ggplot(aes(x = year, y = as.numeric(fastestLapSpeed))) + geom_smooth()

#Ferrari finish position over time
ferrari_results %>% ggplot(aes(x = year,y =  positionOrder)) + geom_smooth()

#Ferrari rank over time
ferrari_results %>% ggplot(aes(x = year, y = as.numeric(rank))) + geom_smooth()

#Ferrari race run time over time
ferrari_results %>% ggplot(aes(x = year, y = as.numeric(milliseconds)/3600000)) + geom_smooth()

#Ferrari wins over time
ferrari_standings %>% ggplot(aes(x = year, y = as.numeric(wins))) + geom_col()
```

